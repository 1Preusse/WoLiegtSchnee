import os
import requests
from zipfile import ZipFile
from io import BytesIO
import csv

# Base URL
base_url = "https://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/daily/water_equiv/recent/"

# List of file names
file_names = [
    "tageswerte_Wa_00020_akt.zip",
    "tageswerte_Wa_00021_akt.zip",
    "tageswerte_Wa_00046_akt.zip",
    "tageswerte_Wa_00073_akt.zip",
    "tageswerte_Wa_00078_akt.zip",
    "tageswerte_Wa_00087_akt.zip",
    "tageswerte_Wa_00103_akt.zip",
    "tageswerte_Wa_00124_akt.zip",
    "tageswerte_Wa_00128_akt.zip",
    "tageswerte_Wa_00130_akt.zip",
    "tageswerte_Wa_00131_akt.zip",
    "tageswerte_Wa_00142_akt.zip",
    "tageswerte_Wa_00151_akt.zip",
    "tageswerte_Wa_00154_akt.zip",
    "tageswerte_Wa_00160_akt.zip",
    "tageswerte_Wa_00167_akt.zip",
    "tageswerte_Wa_00191_akt.zip",
    "tageswerte_Wa_00200_akt.zip",
    "tageswerte_Wa_00203_akt.zip",
    "tageswerte_Wa_00213_akt.zip",
    "tageswerte_Wa_00222_akt.zip",
    "tageswerte_Wa_00227_akt.zip",
    "tageswerte_Wa_00240_akt.zip",
    "tageswerte_Wa_00257_akt.zip",
    "tageswerte_Wa_00259_akt.zip",
    "tageswerte_Wa_00269_akt.zip",
    "tageswerte_Wa_00275_akt.zip",
    "tageswerte_Wa_00277_akt.zip",
    "tageswerte_Wa_00279_akt.zip",
    "tageswerte_Wa_00287_akt.zip",
    "tageswerte_Wa_00301_akt.zip",
    "tageswerte_Wa_00310_akt.zip",
    "tageswerte_Wa_00314_akt.zip",
    "tageswerte_Wa_00320_akt.zip",
    "tageswerte_Wa_00323_akt.zip",
    "tageswerte_Wa_00330_akt.zip",
    "tageswerte_Wa_00336_akt.zip",
    "tageswerte_Wa_00351_akt.zip",
    "tageswerte_Wa_00354_akt.zip",
    "tageswerte_Wa_00360_akt.zip",
    "tageswerte_Wa_00379_akt.zip",
    "tageswerte_Wa_00389_akt.zip",
    "tageswerte_Wa_00390_akt.zip",
    "tageswerte_Wa_00403_akt.zip",
    "tageswerte_Wa_00427_akt.zip",
    "tageswerte_Wa_00430_akt.zip",
    "tageswerte_Wa_00445_akt.zip",
    "tageswerte_Wa_00498_akt.zip",
    "tageswerte_Wa_00550_akt.zip",
    "tageswerte_Wa_00551_akt.zip",
    "tageswerte_Wa_00589_akt.zip",
    "tageswerte_Wa_00613_akt.zip",
    "tageswerte_Wa_00617_akt.zip",
    "tageswerte_Wa_00633_akt.zip",
    "tageswerte_Wa_00653_akt.zip",
    "tageswerte_Wa_00691_akt.zip",
    "tageswerte_Wa_00723_akt.zip",
    "tageswerte_Wa_00755_akt.zip",
    "tageswerte_Wa_00757_akt.zip",
    "tageswerte_Wa_00774_akt.zip",
    "tageswerte_Wa_00789_akt.zip",
    "tageswerte_Wa_00796_akt.zip",
    "tageswerte_Wa_00801_akt.zip",
    "tageswerte_Wa_00807_akt.zip",
    "tageswerte_Wa_00812_akt.zip",
    "tageswerte_Wa_00814_akt.zip",
    "tageswerte_Wa_00815_akt.zip",
    "tageswerte_Wa_00836_akt.zip",
    "tageswerte_Wa_00857_akt.zip",
    "tageswerte_Wa_00885_akt.zip",
    "tageswerte_Wa_00896_akt.zip",
    "tageswerte_Wa_00902_akt.zip",
    "tageswerte_Wa_00922_akt.zip",
    "tageswerte_Wa_00931_akt.zip",
    "tageswerte_Wa_00945_akt.zip",
    "tageswerte_Wa_00962_akt.zip",
    "tageswerte_Wa_00966_akt.zip",
    "tageswerte_Wa_00970_akt.zip",
    "tageswerte_Wa_00974_akt.zip",
    "tageswerte_Wa_00983_akt.zip",
    "tageswerte_Wa_00985_akt.zip",
    "tageswerte_Wa_01039_akt.zip",
    "tageswerte_Wa_01048_akt.zip",
    "tageswerte_Wa_01052_akt.zip",
    "tageswerte_Wa_01078_akt.zip",
    "tageswerte_Wa_01089_akt.zip",
    "tageswerte_Wa_01103_akt.zip",
    "tageswerte_Wa_01107_akt.zip",
    "tageswerte_Wa_01119_akt.zip",
    "tageswerte_Wa_01176_akt.zip",
    "tageswerte_Wa_01197_akt.zip",
    "tageswerte_Wa_01207_akt.zip",
    "tageswerte_Wa_01214_akt.zip",
    "tageswerte_Wa_01216_akt.zip",
    "tageswerte_Wa_01224_akt.zip",
    "tageswerte_Wa_01227_akt.zip",
    "tageswerte_Wa_01237_akt.zip",
    "tageswerte_Wa_01246_akt.zip",
    "tageswerte_Wa_01251_akt.zip",
    "tageswerte_Wa_01256_akt.zip",
    "tageswerte_Wa_01270_akt.zip",
    "tageswerte_Wa_01279_akt.zip",
    "tageswerte_Wa_01282_akt.zip",
    "tageswerte_Wa_01290_akt.zip",
    "tageswerte_Wa_01300_akt.zip",
    "tageswerte_Wa_01320_akt.zip",
    "tageswerte_Wa_01327_akt.zip",
    "tageswerte_Wa_01332_akt.zip",
    "tageswerte_Wa_01343_akt.zip",
    "tageswerte_Wa_01357_akt.zip",
    "tageswerte_Wa_01366_akt.zip",
    "tageswerte_Wa_01382_akt.zip",
    "tageswerte_Wa_01392_akt.zip",
    "tageswerte_Wa_01404_akt.zip",
    "tageswerte_Wa_01411_akt.zip",
    "tageswerte_Wa_01435_akt.zip",
    "tageswerte_Wa_01441_akt.zip",
    "tageswerte_Wa_01451_akt.zip",
    "tageswerte_Wa_01458_akt.zip",
    "tageswerte_Wa_01542_akt.zip",
    "tageswerte_Wa_01573_akt.zip",
    "tageswerte_Wa_01578_akt.zip",
    "tageswerte_Wa_01590_akt.zip",
    "tageswerte_Wa_01598_akt.zip",
    "tageswerte_Wa_01607_akt.zip",
    "tageswerte_Wa_01645_akt.zip",
    "tageswerte_Wa_01650_akt.zip",
    "tageswerte_Wa_01711_akt.zip",
    "tageswerte_Wa_01721_akt.zip",
    "tageswerte_Wa_01726_akt.zip",
    "tageswerte_Wa_01735_akt.zip",
    "tageswerte_Wa_01736_akt.zip",
    "tageswerte_Wa_01766_akt.zip",
    "tageswerte_Wa_01801_akt.zip",
    "tageswerte_Wa_01803_akt.zip",
    "tageswerte_Wa_01844_akt.zip",
    "tageswerte_Wa_01885_akt.zip",
    "tageswerte_Wa_01886_akt.zip",
    "tageswerte_Wa_01900_akt.zip",
    "tageswerte_Wa_01937_akt.zip",
    "tageswerte_Wa_01975_akt.zip",
    "tageswerte_Wa_02014_akt.zip",
    "tageswerte_Wa_02027_akt.zip",
    "tageswerte_Wa_02050_akt.zip",
    "tageswerte_Wa_02062_akt.zip",
    "tageswerte_Wa_02064_akt.zip",
    "tageswerte_Wa_02073_akt.zip",
    "tageswerte_Wa_02074_akt.zip",
    "tageswerte_Wa_02088_akt.zip",
    "tageswerte_Wa_02109_akt.zip",
    "tageswerte_Wa_02110_akt.zip",
    "tageswerte_Wa_02117_akt.zip",
    "tageswerte_Wa_02119_akt.zip",
    "tageswerte_Wa_02159_akt.zip",
    "tageswerte_Wa_02174_akt.zip",
    "tageswerte_Wa_02175_akt.zip",
    "tageswerte_Wa_02233_akt.zip",
    "tageswerte_Wa_02252_akt.zip",
    "tageswerte_Wa_02274_akt.zip",
    "tageswerte_Wa_02278_akt.zip",
    "tageswerte_Wa_02294_akt.zip",
    "tageswerte_Wa_02306_akt.zip",
    "tageswerte_Wa_02319_akt.zip",
    "tageswerte_Wa_02323_akt.zip",
    "tageswerte_Wa_02372_akt.zip",
    "tageswerte_Wa_02387_akt.zip",
    "tageswerte_Wa_02405_akt.zip",
    "tageswerte_Wa_02416_akt.zip",
    "tageswerte_Wa_02431_akt.zip",
    "tageswerte_Wa_02444_akt.zip",
    "tageswerte_Wa_02480_akt.zip",
    "tageswerte_Wa_02497_akt.zip",
    "tageswerte_Wa_02538_akt.zip",
    "tageswerte_Wa_02546_akt.zip",
    "tageswerte_Wa_02556_akt.zip",
    "tageswerte_Wa_02562_akt.zip",
    "tageswerte_Wa_02575_akt.zip",
    "tageswerte_Wa_02600_akt.zip",
    "tageswerte_Wa_02618_akt.zip",
    "tageswerte_Wa_02625_akt.zip",
    "tageswerte_Wa_02627_akt.zip",
    "tageswerte_Wa_02629_akt.zip",
    "tageswerte_Wa_02641_akt.zip",
    "tageswerte_Wa_02662_akt.zip",
    "tageswerte_Wa_02667_akt.zip",
    "tageswerte_Wa_02680_akt.zip",
    "tageswerte_Wa_02689_akt.zip",
    "tageswerte_Wa_02700_akt.zip",
    "tageswerte_Wa_02704_akt.zip",
    "tageswerte_Wa_02708_akt.zip",
    "tageswerte_Wa_02709_akt.zip",
    "tageswerte_Wa_02740_akt.zip",
    "tageswerte_Wa_02744_akt.zip",
    "tageswerte_Wa_02750_akt.zip",
    "tageswerte_Wa_02792_akt.zip",
    "tageswerte_Wa_02805_akt.zip",
    "tageswerte_Wa_02814_akt.zip",
    "tageswerte_Wa_02819_akt.zip",
    "tageswerte_Wa_02850_akt.zip",
    "tageswerte_Wa_02878_akt.zip",
    "tageswerte_Wa_02890_akt.zip",
    "tageswerte_Wa_02932_akt.zip",
    "tageswerte_Wa_02947_akt.zip",
    "tageswerte_Wa_02951_akt.zip",
    "tageswerte_Wa_02953_akt.zip",
    "tageswerte_Wa_02958_akt.zip",
    "tageswerte_Wa_02965_akt.zip",
    "tageswerte_Wa_02979_akt.zip",
    "tageswerte_Wa_02992_akt.zip",
    "tageswerte_Wa_03031_akt.zip",
    "tageswerte_Wa_03034_akt.zip",
    "tageswerte_Wa_03059_akt.zip",
    "tageswerte_Wa_03065_akt.zip",
    "tageswerte_Wa_03080_akt.zip",
    "tageswerte_Wa_03083_akt.zip",
    "tageswerte_Wa_03094_akt.zip",
    "tageswerte_Wa_03114_akt.zip",
    "tageswerte_Wa_03121_akt.zip",
    "tageswerte_Wa_03131_akt.zip",
    "tageswerte_Wa_03153_akt.zip",
    "tageswerte_Wa_03155_akt.zip",
    "tageswerte_Wa_03175_akt.zip",
    "tageswerte_Wa_03179_akt.zip",
    "tageswerte_Wa_03181_akt.zip",
    "tageswerte_Wa_03204_akt.zip",
    "tageswerte_Wa_03207_akt.zip",
    "tageswerte_Wa_03211_akt.zip",
    "tageswerte_Wa_03215_akt.zip",
    "tageswerte_Wa_03220_akt.zip",
    "tageswerte_Wa_03226_akt.zip",
    "tageswerte_Wa_03234_akt.zip",
    "tageswerte_Wa_03247_akt.zip",
    "tageswerte_Wa_03248_akt.zip",
    "tageswerte_Wa_03253_akt.zip",
    "tageswerte_Wa_03257_akt.zip",
    "tageswerte_Wa_03258_akt.zip",
    "tageswerte_Wa_03278_akt.zip",
    "tageswerte_Wa_03279_akt.zip",
    "tageswerte_Wa_03289_akt.zip",
    "tageswerte_Wa_03293_akt.zip",
    "tageswerte_Wa_03304_akt.zip",
    "tageswerte_Wa_03307_akt.zip",
    "tageswerte_Wa_03308_akt.zip",
    "tageswerte_Wa_03319_akt.zip",
    "tageswerte_Wa_03339_akt.zip",
    "tageswerte_Wa_03348_akt.zip",
    "tageswerte_Wa_03350_akt.zip",
    "tageswerte_Wa_03364_akt.zip",
    "tageswerte_Wa_03376_akt.zip",
    "tageswerte_Wa_03402_akt.zip",
    "tageswerte_Wa_03418_akt.zip",
    "tageswerte_Wa_03426_akt.zip",
    "tageswerte_Wa_03429_akt.zip",
    "tageswerte_Wa_03435_akt.zip",
    "tageswerte_Wa_03438_akt.zip",
    "tageswerte_Wa_03445_akt.zip",
    "tageswerte_Wa_03485_akt.zip",
    "tageswerte_Wa_03490_akt.zip",
    "tageswerte_Wa_03491_akt.zip",
    "tageswerte_Wa_03497_akt.zip",
    "tageswerte_Wa_03509_akt.zip",
    "tageswerte_Wa_03519_akt.zip",
    "tageswerte_Wa_03527_akt.zip",
    "tageswerte_Wa_03536_akt.zip",
    "tageswerte_Wa_03540_akt.zip",
    "tageswerte_Wa_03560_akt.zip",
    "tageswerte_Wa_03571_akt.zip",
    "tageswerte_Wa_03589_akt.zip",
    "tageswerte_Wa_03591_akt.zip",
    "tageswerte_Wa_03607_akt.zip",
    "tageswerte_Wa_03617_akt.zip",
    "tageswerte_Wa_03621_akt.zip",
    "tageswerte_Wa_03625_akt.zip",
    "tageswerte_Wa_03667_akt.zip",
    "tageswerte_Wa_03668_akt.zip",
    "tageswerte_Wa_03677_akt.zip",
    "tageswerte_Wa_03679_akt.zip",
    "tageswerte_Wa_03681_akt.zip",
    "tageswerte_Wa_03700_akt.zip",
    "tageswerte_Wa_03713_akt.zip",
    "tageswerte_Wa_03714_akt.zip",
    "tageswerte_Wa_03722_akt.zip",
    "tageswerte_Wa_03739_akt.zip",
    "tageswerte_Wa_03740_akt.zip",
    "tageswerte_Wa_03764_akt.zip",
    "tageswerte_Wa_03836_akt.zip",
    "tageswerte_Wa_03849_akt.zip",
    "tageswerte_Wa_03857_akt.zip",
    "tageswerte_Wa_03875_akt.zip",
    "tageswerte_Wa_03925_akt.zip",
    "tageswerte_Wa_03926_akt.zip",
    "tageswerte_Wa_03927_akt.zip",
    "tageswerte_Wa_03945_akt.zip",
    "tageswerte_Wa_03948_akt.zip",
    "tageswerte_Wa_03960_akt.zip",
    "tageswerte_Wa_03972_akt.zip",
    "tageswerte_Wa_03975_akt.zip",
    "tageswerte_Wa_03999_akt.zip",
    "tageswerte_Wa_04000_akt.zip",
    "tageswerte_Wa_04032_akt.zip",
    "tageswerte_Wa_04036_akt.zip",
    "tageswerte_Wa_04063_akt.zip",
    "tageswerte_Wa_04101_akt.zip",
    "tageswerte_Wa_04127_akt.zip",
    "tageswerte_Wa_04135_akt.zip",
    "tageswerte_Wa_04149_akt.zip",
    "tageswerte_Wa_04159_akt.zip",
    "tageswerte_Wa_04160_akt.zip",
    "tageswerte_Wa_04169_akt.zip",
    "tageswerte_Wa_04175_akt.zip",
    "tageswerte_Wa_04185_akt.zip",
    "tageswerte_Wa_04189_akt.zip",
    "tageswerte_Wa_04218_akt.zip",
    "tageswerte_Wa_04224_akt.zip",
    "tageswerte_Wa_04261_akt.zip",
    "tageswerte_Wa_04282_akt.zip",
    "tageswerte_Wa_04284_akt.zip",
    "tageswerte_Wa_04287_akt.zip",
    "tageswerte_Wa_04294_akt.zip",
    "tageswerte_Wa_04300_akt.zip",
    "tageswerte_Wa_04301_akt.zip",
    "tageswerte_Wa_04313_akt.zip",
    "tageswerte_Wa_04315_akt.zip",
    "tageswerte_Wa_04323_akt.zip",
    "tageswerte_Wa_04336_akt.zip",
    "tageswerte_Wa_04349_akt.zip",
    "tageswerte_Wa_04374_akt.zip",
    "tageswerte_Wa_04377_akt.zip",
    "tageswerte_Wa_04409_akt.zip",
    "tageswerte_Wa_04413_akt.zip",
    "tageswerte_Wa_04441_akt.zip",
    "tageswerte_Wa_04445_akt.zip",
    "tageswerte_Wa_04469_akt.zip",
    "tageswerte_Wa_04490_akt.zip",
    "tageswerte_Wa_04493_akt.zip",
    "tageswerte_Wa_04494_akt.zip",
    "tageswerte_Wa_04501_akt.zip",
    "tageswerte_Wa_04508_akt.zip",
    "tageswerte_Wa_04516_akt.zip",
    "tageswerte_Wa_04546_akt.zip",
    "tageswerte_Wa_04559_akt.zip",
    "tageswerte_Wa_04560_akt.zip",
    "tageswerte_Wa_04592_akt.zip",
    "tageswerte_Wa_04603_akt.zip",
    "tageswerte_Wa_04605_akt.zip",
    "tageswerte_Wa_04618_akt.zip",
    "tageswerte_Wa_04651_akt.zip",
    "tageswerte_Wa_04690_akt.zip",
    "tageswerte_Wa_04694_akt.zip",
    "tageswerte_Wa_04703_akt.zip",
    "tageswerte_Wa_04704_akt.zip",
    "tageswerte_Wa_04706_akt.zip",
    "tageswerte_Wa_04709_akt.zip",
    "tageswerte_Wa_04710_akt.zip",
    "tageswerte_Wa_04712_akt.zip",
    "tageswerte_Wa_04748_akt.zip",
    "tageswerte_Wa_04755_akt.zip",
    "tageswerte_Wa_04757_akt.zip",
    "tageswerte_Wa_04760_akt.zip",
    "tageswerte_Wa_04790_akt.zip",
    "tageswerte_Wa_04798_akt.zip",
    "tageswerte_Wa_04801_akt.zip",
    "tageswerte_Wa_04816_akt.zip",
    "tageswerte_Wa_04818_akt.zip",
    "tageswerte_Wa_04821_akt.zip",
    "tageswerte_Wa_04827_akt.zip",
    "tageswerte_Wa_04850_akt.zip",
    "tageswerte_Wa_04854_akt.zip",
    "tageswerte_Wa_04858_akt.zip",
    "tageswerte_Wa_04864_akt.zip",
    "tageswerte_Wa_04878_akt.zip",
    "tageswerte_Wa_04896_akt.zip",
    "tageswerte_Wa_04946_akt.zip",
    "tageswerte_Wa_04958_akt.zip",
    "tageswerte_Wa_04982_akt.zip",
    "tageswerte_Wa_04984_akt.zip",
    "tageswerte_Wa_04997_akt.zip",
    "tageswerte_Wa_05000_akt.zip",
    "tageswerte_Wa_05009_akt.zip",
    "tageswerte_Wa_05014_akt.zip",
    "tageswerte_Wa_05017_akt.zip",
    "tageswerte_Wa_05020_akt.zip",
    "tageswerte_Wa_05023_akt.zip",
    "tageswerte_Wa_05034_akt.zip",
    "tageswerte_Wa_05036_akt.zip",
    "tageswerte_Wa_05046_akt.zip",
    "tageswerte_Wa_05055_akt.zip",
    "tageswerte_Wa_05064_akt.zip",
    "tageswerte_Wa_05084_akt.zip",
    "tageswerte_Wa_05108_akt.zip",
    "tageswerte_Wa_05111_akt.zip",
    "tageswerte_Wa_05146_akt.zip",
    "tageswerte_Wa_05161_akt.zip",
    "tageswerte_Wa_05162_akt.zip",
    "tageswerte_Wa_05169_akt.zip",
    "tageswerte_Wa_05227_akt.zip",
    "tageswerte_Wa_05229_akt.zip",
    "tageswerte_Wa_05230_akt.zip",
    "tageswerte_Wa_05262_akt.zip",
    "tageswerte_Wa_05275_akt.zip",
    "tageswerte_Wa_05276_akt.zip",
    "tageswerte_Wa_05280_akt.zip",
    "tageswerte_Wa_05285_akt.zip",
    "tageswerte_Wa_05300_akt.zip",
    "tageswerte_Wa_05318_akt.zip",
    "tageswerte_Wa_05335_akt.zip",
    "tageswerte_Wa_05374_akt.zip",
    "tageswerte_Wa_05376_akt.zip",
    "tageswerte_Wa_05395_akt.zip",
    "tageswerte_Wa_05399_akt.zip",
    "tageswerte_Wa_05401_akt.zip",
    "tageswerte_Wa_05424_akt.zip",
    "tageswerte_Wa_05444_akt.zip",
    "tageswerte_Wa_05470_akt.zip",
    "tageswerte_Wa_05484_akt.zip",
    "tageswerte_Wa_05501_akt.zip",
    "tageswerte_Wa_05511_akt.zip",
    "tageswerte_Wa_05538_akt.zip",
    "tageswerte_Wa_05555_akt.zip",
    "tageswerte_Wa_05559_akt.zip",
    "tageswerte_Wa_05562_akt.zip",
    "tageswerte_Wa_05573_akt.zip",
    "tageswerte_Wa_05600_akt.zip",
    "tageswerte_Wa_05610_akt.zip",
    "tageswerte_Wa_05611_akt.zip",
    "tageswerte_Wa_05619_akt.zip",
    "tageswerte_Wa_05643_akt.zip",
    "tageswerte_Wa_05646_akt.zip",
    "tageswerte_Wa_05664_akt.zip",
    "tageswerte_Wa_05676_akt.zip",
    "tageswerte_Wa_05688_akt.zip",
    "tageswerte_Wa_05699_akt.zip",
    "tageswerte_Wa_05711_akt.zip",
    "tageswerte_Wa_05717_akt.zip",
    "tageswerte_Wa_05721_akt.zip",
    "tageswerte_Wa_05724_akt.zip",
    "tageswerte_Wa_05729_akt.zip",
    "tageswerte_Wa_05731_akt.zip",
    "tageswerte_Wa_05745_akt.zip",
    "tageswerte_Wa_05750_akt.zip",
    "tageswerte_Wa_05793_akt.zip",
    "tageswerte_Wa_05797_akt.zip",
    "tageswerte_Wa_05814_akt.zip",
    "tageswerte_Wa_05822_akt.zip",
    "tageswerte_Wa_05825_akt.zip",
    "tageswerte_Wa_05912_akt.zip",
    "tageswerte_Wa_05941_akt.zip",
    "tageswerte_Wa_05943_akt.zip",
    "tageswerte_Wa_06105_akt.zip",
    "tageswerte_Wa_06129_akt.zip",
    "tageswerte_Wa_06157_akt.zip",
    "tageswerte_Wa_06158_akt.zip",
    "tageswerte_Wa_06159_akt.zip",
    "tageswerte_Wa_06170_akt.zip",
    "tageswerte_Wa_06190_akt.zip",
    "tageswerte_Wa_06191_akt.zip",
    "tageswerte_Wa_06199_akt.zip",
    "tageswerte_Wa_06200_akt.zip",
    "tageswerte_Wa_06215_akt.zip",
    "tageswerte_Wa_06257_akt.zip",
    "tageswerte_Wa_06258_akt.zip",
    "tageswerte_Wa_06259_akt.zip",
    "tageswerte_Wa_06260_akt.zip",
    "tageswerte_Wa_06262_akt.zip",
    "tageswerte_Wa_06264_akt.zip",
    "tageswerte_Wa_06265_akt.zip",
    "tageswerte_Wa_06266_akt.zip",
    "tageswerte_Wa_06268_akt.zip",
    "tageswerte_Wa_06270_akt.zip",
    "tageswerte_Wa_06271_akt.zip",
    "tageswerte_Wa_06272_akt.zip",
    "tageswerte_Wa_06273_akt.zip",
    "tageswerte_Wa_06275_akt.zip",
    "tageswerte_Wa_06284_akt.zip",
    "tageswerte_Wa_06295_akt.zip",
    "tageswerte_Wa_06305_akt.zip",
    "tageswerte_Wa_06310_akt.zip",
    "tageswerte_Wa_06313_akt.zip",
    "tageswerte_Wa_06314_akt.zip",
    "tageswerte_Wa_06336_akt.zip",
    "tageswerte_Wa_06337_akt.zip",
    "tageswerte_Wa_06338_akt.zip",
    "tageswerte_Wa_06346_akt.zip",
    "tageswerte_Wa_06347_akt.zip",
    "tageswerte_Wa_07077_akt.zip",
    "tageswerte_Wa_07105_akt.zip",
    "tageswerte_Wa_07138_akt.zip",
    "tageswerte_Wa_07187_akt.zip",
    "tageswerte_Wa_07298_akt.zip",
    "tageswerte_Wa_07319_akt.zip",
    "tageswerte_Wa_07321_akt.zip",
    "tageswerte_Wa_07322_akt.zip",
    "tageswerte_Wa_07328_akt.zip",
    "tageswerte_Wa_07329_akt.zip",
    "tageswerte_Wa_07333_akt.zip",
    "tageswerte_Wa_07335_akt.zip",
    "tageswerte_Wa_07337_akt.zip",
    "tageswerte_Wa_07343_akt.zip",
    "tageswerte_Wa_07350_akt.zip",
    "tageswerte_Wa_07364_akt.zip",
    "tageswerte_Wa_07372_akt.zip",
    "tageswerte_Wa_07382_akt.zip",
    "tageswerte_Wa_07389_akt.zip",
    "tageswerte_Wa_07419_akt.zip",
    "tageswerte_Wa_07420_akt.zip",
    "tageswerte_Wa_07421_akt.zip",
    "tageswerte_Wa_07423_akt.zip",
    "tageswerte_Wa_07424_akt.zip",
    "tageswerte_Wa_07428_akt.zip",
    "tageswerte_Wa_07429_akt.zip",
    "tageswerte_Wa_07430_akt.zip",
    "tageswerte_Wa_07431_akt.zip",
    "tageswerte_Wa_13654_akt.zip",
    "tageswerte_Wa_13675_akt.zip",
    "tageswerte_Wa_13696_akt.zip",
    "tageswerte_Wa_13698_akt.zip",
    "tageswerte_Wa_13700_akt.zip",
    "tageswerte_Wa_13710_akt.zip",
    "tageswerte_Wa_13711_akt.zip",
    "tageswerte_Wa_13715_akt.zip",
    "tageswerte_Wa_13774_akt.zip",
    "tageswerte_Wa_13777_akt.zip",
    "tageswerte_Wa_13786_akt.zip",
    "tageswerte_Wa_14135_akt.zip",
    "tageswerte_Wa_15003_akt.zip",
    "tageswerte_Wa_15232_akt.zip",
    "tageswerte_Wa_15235_akt.zip",
    "tageswerte_Wa_15478_akt.zip",
    "tageswerte_Wa_15490_akt.zip",
    "tageswerte_Wa_15555_akt.zip",
    "tageswerte_Wa_15936_akt.zip",
    "tageswerte_Wa_19039_akt.zip",
    "tageswerte_Wa_19041_akt.zip",
    "tageswerte_Wa_19140_akt.zip",
    "tageswerte_Wa_19209_akt.zip",
    "tageswerte_Wa_19279_akt.zip",
    "tageswerte_Wa_19299_akt.zip",
    "tageswerte_Wa_19434_akt.zip",
    "tageswerte_Wa_19806_akt.zip",
    "tageswerte_Wa_19849_akt.zip"
    ]

# Create directories
if not os.path.exists("downloaded_data"):
    os.makedirs("downloaded_data")
if not os.path.exists("processed_data"):
    os.makedirs("processed_data")

def download_and_extract_schneehoehe(file_name):
    url = base_url + file_name
    print(f"Downloading {file_name}...")
    response = requests.get(url)
    
    if response.status_code == 200:
        with ZipFile(BytesIO(response.content)) as zip_file:
            for zip_info in zip_file.infolist():
                if zip_info.filename.endswith('.txt') and 'Schneehoehe' in zip_info.filename:
                    zip_info.filename = os.path.basename(zip_info.filename)
                    zip_file.extract(zip_info, "downloaded_data")
                    print(f"Extracted {zip_info.filename}")
        print(f"Successfully processed {file_name}")
    else:
        print(f"Failed to download {file_name}. Status code: {response.status_code}")

def process_data():
    processed_data = []
    for filename in os.listdir("downloaded_data"):
        if filename.endswith('.txt') and 'Schneehoehe' in filename:
            encodings_to_try = ['utf-8', 'iso-8859-1', 'windows-1252']
            
            for encoding in encodings_to_try:
                try:
                    with open(os.path.join("downloaded_data", filename), 'r', encoding=encoding) as file:
                        csv_reader = csv.reader(file, delimiter=';')
                        next(csv_reader)  # Skip header
                        for row in csv_reader:
                            if row and len(row) >= 6:  # Ensure row has enough columns
                                station_id = row[0]
                                station_name = row[1]
                                longitude = row[2]
                                latitude = row[3]
                                height = row[4]
                                sensor_height = row[5]
                                from_date = row[6] if len(row) > 6 else ''
                                to_date = row[7] if len(row) > 7 else ''
                                processed_data.append([station_id, station_name, longitude, latitude, height, sensor_height, from_date, to_date])
                    break  # If successful, break the encoding loop
                except UnicodeDecodeError:
                    if encoding == encodings_to_try[-1]:
                        print(f"Failed to decode {filename} with all attempted encodings.")
                    continue
    
    # Remove duplicates and keep the latest entry for each station
    processed_data.sort(key=lambda x: (x[0], x[7]), reverse=True)  # Sort by station ID and to_date (descending)
    unique_data = []
    seen_stations = set()
    for row in processed_data:
        if row[0] not in seen_stations:
            unique_data.append(row)
            seen_stations.add(row[0])
    
    # Write processed data to CSV
    with open(os.path.join("processed_data", "snow_stations.csv"), 'w', newline='', encoding='utf-8') as file:
        csv_writer = csv.writer(file)
        csv_writer.writerow(["Station ID", "Station Name", "Longitude", "Latitude", "Station Height", "Sensor Height", "From Date", "To Date"])
        csv_writer.writerows(unique_data)
    
    print(f"Processed data saved to processed_data/snow_stations.csv")

# Download and extract each file
for file_name in file_names:
    download_and_extract_schneehoehe(file_name)

# Process the downloaded data
process_data()

print("All files have been processed.")